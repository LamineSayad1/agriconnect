[{"filePath":"E:\\agri\\.expo\\types\\router.d.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'T' is defined but never used.","line":8,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\(tabs)\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\(tabs)\\index.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkUser'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [checkUser]","fix":{"range":[701,703],"text":"[checkUser]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\(tabs)\\orders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\(tabs)\\profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\(tabs)\\search.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\_layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\add-product.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\add-supply.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\cart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\edit-profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\farmer-profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\my-products.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\product-details.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\signup.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\submit-review.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\supplier-profile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\supply-details.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\app\\supply-market.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\babel.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\components\\homes\\BuyerHome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'topFarms' is assigned a value but never used.","line":27,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabaseClient';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { useFocusEffect } from '@react-navigation/native';\r\nimport { useRouter } from 'expo-router';\r\nimport { StatusBar } from 'expo-status-bar';\r\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  RefreshControl,\r\n  ScrollView,\r\n  Text,\r\n  TextInput,\r\n  TouchableOpacity,\r\n  View\r\n} from 'react-native';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\n\r\nexport default function BuyerHome() {\r\n  const router = useRouter();\r\n\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [user, setUser] = useState<any>(null);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\r\n\r\n  const [products, setProducts] = useState<any[]>([]);\r\n  const [topFarms, setTopFarms] = useState<any[]>([]);\r\n  const [cartCount, setCartCount] = useState(0);\r\n\r\n  const categories = useMemo(\r\n    () => [\r\n      { name: 'Fruits', slug: 'fruits', icon: 'ðŸŽ' },\r\n      { name: 'Vegetables', slug: 'vegetables', icon: 'ðŸ¥¦' },\r\n      { name: 'Dairy', slug: 'dairy', icon: 'ðŸ¥›' },\r\n      { name: 'Grains', slug: 'grains', icon: 'ðŸŒ¾' },\r\n      { name: 'Meat', slug: 'meat', icon: 'ðŸ¥©' },\r\n    ],\r\n    []\r\n  );\r\n\r\n  /* ===================== USER ===================== */\r\n  const getUser = useCallback(async () => {\r\n    const { data } = await supabase.auth.getUser();\r\n    if (!data?.user) return setUser(null);\r\n\r\n    const { data: profile } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('id', data.user.id)\r\n      .single();\r\n\r\n    setUser({ ...data.user, ...profile });\r\n  }, []);\r\n\r\n  /* ===================== CART ===================== */\r\n  const updateCartCount = useCallback(async () => {\r\n    const cartStr = await AsyncStorage.getItem('cart');\r\n    if (!cartStr) return setCartCount(0);\r\n\r\n    const cart = JSON.parse(cartStr);\r\n    const total = cart.reduce(\r\n      (sum: number, item: any) => sum + (item.quantity || 0),\r\n      0\r\n    );\r\n    setCartCount(total);\r\n  }, []);\r\n\r\n  const addToCart = useCallback(\r\n    async (product: any) => {\r\n      const cartStr = await AsyncStorage.getItem('cart');\r\n      const cart = cartStr ? JSON.parse(cartStr) : [];\r\n\r\n      const index = cart.findIndex((i: any) => i.id === product.id);\r\n\r\n      if (index >= 0) cart[index].quantity += 1;\r\n      else cart.push({ ...product, quantity: 1 });\r\n\r\n      await AsyncStorage.setItem('cart', JSON.stringify(cart));\r\n      updateCartCount();\r\n    },\r\n    [updateCartCount]\r\n  );\r\n\r\n  /* ===================== DATA ===================== */\r\n  const fetchTopFarms = useCallback(async () => {\r\n    const { data } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('role', 'farmer')\r\n      .limit(5);\r\n\r\n    setTopFarms(data || []);\r\n  }, []);\r\n\r\n  const fetchProducts = useCallback(async () => {\r\n    let query = supabase.from('products').select('*').gt('stock', 0);\r\n\r\n    if (selectedCategory) {\r\n      query = query.eq('category', selectedCategory);\r\n    }\r\n\r\n    const { data } = await query;\r\n    setProducts(data || []);\r\n  }, [selectedCategory]);\r\n\r\n  /* ===================== EFFECTS ===================== */\r\n  useEffect(() => {\r\n    getUser();\r\n    fetchTopFarms();\r\n    fetchProducts();\r\n  }, [getUser, fetchTopFarms, fetchProducts]);\r\n\r\n  useFocusEffect(\r\n    useCallback(() => {\r\n      updateCartCount();\r\n    }, [updateCartCount])\r\n  );\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await Promise.all([fetchProducts(), fetchTopFarms(), getUser(), updateCartCount()]);\r\n    setRefreshing(false);\r\n  };\r\n\r\n  /* ===================== LOGOUT ===================== */\r\n  const handleLogout = async () => {\r\n    try {\r\n      console.log(\"[BuyerHome] Logout clicked. Setting flag...\");\r\n      await AsyncStorage.setItem('logging_out', 'true');\r\n      console.log(\"[BuyerHome] Flag set. Redirecting...\");\r\n      (router as any).replace(\"/\"); // Redirection immÃ©diate\r\n\r\n      // Cleanup de fond\r\n      await supabase.auth.signOut();\r\n      await AsyncStorage.multiRemove(['user_session', 'cart']);\r\n      console.log(\"[BuyerHome] Content cleared.\");\r\n    } catch (error) {\r\n      console.error(\"[BuyerHome] Logout error:\", error);\r\n      (router as any).replace(\"/\");\r\n    }\r\n  };\r\n\r\n\r\n\r\n  /* ===================== FILTER ===================== */\r\n  const filteredProducts = useMemo(() => {\r\n    if (!searchQuery) return products;\r\n    return products.filter((p) =>\r\n      p.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n  }, [products, searchQuery]);\r\n\r\n  /* ===================== UI ===================== */\r\n  return (\r\n    <View className=\"flex-1 bg-white\">\r\n      <StatusBar style=\"dark\" />\r\n\r\n      <SafeAreaView className=\"bg-green-50\">\r\n        <View className=\"px-6 py-4 flex-row justify-between items-center\">\r\n          <View>\r\n            <Text className=\"text-gray-600 text-sm\">Good morning</Text>\r\n            <Text className=\"text-2xl font-bold text-green-800\">\r\n              {user?.full_name?.split(' ')[0] || 'User'}\r\n            </Text>\r\n          </View>\r\n\r\n          <TouchableOpacity onPress={handleLogout}>\r\n            <Ionicons name=\"log-out-outline\" size={26} color=\"#dc2626\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <View className=\"px-6 pb-4\">\r\n          <View className=\"bg-white rounded-xl px-4 py-2 flex-row items-center\">\r\n            <Ionicons name=\"search\" size={20} color=\"#9ca3af\" />\r\n            <TextInput\r\n              placeholder=\"Search products...\"\r\n              className=\"flex-1 ml-2\"\r\n              value={searchQuery}\r\n              onChangeText={setSearchQuery}\r\n            />\r\n            <Text className=\"ml-2 text-green-600 font-bold\">\r\n              ðŸ›’ {cartCount}\r\n            </Text>\r\n          </View>\r\n        </View>\r\n      </SafeAreaView>\r\n\r\n      <ScrollView\r\n        className=\"px-6\"\r\n        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}\r\n      >\r\n        <Text className=\"text-lg font-bold my-4\">Categories</Text>\r\n\r\n        <ScrollView horizontal showsHorizontalScrollIndicator={false}>\r\n          {categories.map((cat) => (\r\n            <TouchableOpacity\r\n              key={cat.slug}\r\n              onPress={() =>\r\n                setSelectedCategory((prev) => (prev === cat.slug ? null : cat.slug))\r\n              }\r\n              className={`mr-3 px-5 py-3 rounded-xl ${selectedCategory === cat.slug ? 'bg-green-600' : 'bg-green-100'\r\n                }`}\r\n            >\r\n              <Text\r\n                className={`font-bold ${selectedCategory === cat.slug ? 'text-white' : 'text-green-700'\r\n                  }`}\r\n              >\r\n                {cat.icon} {cat.name}\r\n              </Text>\r\n            </TouchableOpacity>\r\n          ))}\r\n        </ScrollView>\r\n\r\n        <Text className=\"text-lg font-bold my-4\">Products</Text>\r\n\r\n        <View className=\"flex-row flex-wrap justify-between\">\r\n          {filteredProducts.map((p) => (\r\n            <View\r\n              key={p.id}\r\n              className=\"w-[48%] bg-white rounded-xl p-3 mb-4 border\"\r\n            >\r\n              <Text className=\"text-3xl text-center mb-2\">ðŸ“¦</Text>\r\n              <Text className=\"font-bold\" numberOfLines={1}>\r\n                {p.name}\r\n              </Text>\r\n              <View className=\"flex-row justify-between items-center mt-2\">\r\n                <Text className=\"text-green-600 font-bold\">${p.price}</Text>\r\n                <TouchableOpacity onPress={() => addToCart(p)}>\r\n                  <Ionicons name=\"add-circle\" size={26} color=\"#16a34a\" />\r\n                </TouchableOpacity>\r\n              </View>\r\n            </View>\r\n          ))}\r\n        </View>\r\n      </ScrollView>\r\n    </View>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\agri\\components\\homes\\FarmerHome.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'loadFarmerData'. Either include it or remove the dependency array.","line":186,"column":6,"nodeType":"ArrayExpression","endLine":186,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadFarmerData]","fix":{"range":[5887,5893],"text":"[loadFarmerData]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":195,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":195,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabaseClient';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { useRouter } from \"expo-router\";\r\nimport { StatusBar } from \"expo-status-bar\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport {\r\n  ActivityIndicator,\r\n  RefreshControl,\r\n  ScrollView,\r\n  Text,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\n\r\n// -------------------- Types --------------------\r\ninterface User {\r\n  id: string;\r\n  full_name: string;\r\n  email?: string;\r\n  farm_name?: string;\r\n  phone?: string;\r\n  avatar_url?: string;\r\n}\r\n\r\ninterface FarmerStats {\r\n  productsListed: number;\r\n  ordersToday: number;\r\n  totalRevenue: number;\r\n  farmRating: number;\r\n  pendingOrders: number;\r\n  lowStockItems: number;\r\n}\r\n\r\ntype OrderStatus = 'pending' | 'shipped' | 'delivered' | 'cancelled';\r\n\r\ninterface Order {\r\n  id: string;\r\n  product: string;\r\n  buyer: string;\r\n  status: OrderStatus;\r\n  amount: string;\r\n  date: string;\r\n  quantity?: number;\r\n}\r\n\r\n// -------------------- Component --------------------\r\nexport default function FarmerHome() {\r\n  const router = useRouter();\r\n\r\n  // State\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n  const [farmerStats, setFarmerStats] = useState<FarmerStats>({\r\n    productsListed: 0,\r\n    ordersToday: 0,\r\n    totalRevenue: 0,\r\n    farmRating: 0,\r\n    pendingOrders: 0,\r\n    lowStockItems: 0,\r\n  });\r\n  const [recentOrders, setRecentOrders] = useState<Order[]>([]);\r\n\r\n  const initializeUser = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const sessionData = await AsyncStorage.getItem('user_session');\r\n      let userData = sessionData ? JSON.parse(sessionData) : null;\r\n\r\n      if (!userData) {\r\n        const { data: { user: authUser } } = await supabase.auth.getUser();\r\n        if (authUser) {\r\n          userData = { id: authUser.id, email: authUser.email };\r\n        }\r\n      }\r\n\r\n      if (!userData) throw new Error('No session found');\r\n      setUser(userData);\r\n\r\n      const { data: profile } = await supabase.from('profiles').select('*').eq('id', userData.id).maybeSingle();\r\n      if (profile) setUser(prev => ({ ...prev, ...profile } as User));\r\n\r\n    } catch (error) {\r\n      console.log(\"[FarmerHome] Auth error:\", error);\r\n      router.replace(\"/\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [router]);\r\n\r\n  const loadFarmerData = useCallback(async () => {\r\n    if (!user?.id) return;\r\n\r\n    try {\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const { data: products } = await supabase.from('products').select('id, stock').eq('farmer_id', user.id);\r\n\r\n      const { data: salesItems } = await supabase\r\n        .from('order_items')\r\n        .select(`\r\n          quantity, \r\n          price, \r\n          order:orders!inner(id, status, created_at), \r\n          product:products!inner(id, farmer_id)\r\n        `)\r\n        .eq('product.farmer_id', user.id);\r\n\r\n      const allItems: any[] = salesItems || [];\r\n      const getOrder = (item: any) => Array.isArray(item.order) ? item.order[0] : item.order;\r\n\r\n      const ordersToday = allItems.filter(i => {\r\n        const order = getOrder(i);\r\n        return order?.created_at && order.created_at >= today;\r\n      }).length;\r\n\r\n      const pendingOrders = allItems.filter(i => {\r\n        const order = getOrder(i);\r\n        return order?.status === 'pending';\r\n      }).length;\r\n\r\n      const totalRevenue = allItems\r\n        .filter(i => getOrder(i)?.status === 'delivered')\r\n        .reduce((sum, i) => sum + (i.quantity * (i.price || 0)), 0);\r\n\r\n      const { data: reviewData } = await supabase.from('reviews').select('rating, product:products!inner(farmer_id)').eq('product.farmer_id', user.id);\r\n      const avgRating = reviewData && reviewData.length ? reviewData.reduce((a, b) => a + (b.rating || 0), 0) / reviewData.length : 0;\r\n\r\n      setFarmerStats({\r\n        productsListed: products?.length || 0,\r\n        ordersToday,\r\n        totalRevenue: Math.round(totalRevenue * 100) / 100,\r\n        farmRating: Math.round(avgRating * 10) / 10,\r\n        pendingOrders,\r\n        lowStockItems: products?.filter((p: any) => (p.stock || 0) < 10).length || 0\r\n      });\r\n\r\n      // Orders\r\n      const { data: orderData } = await supabase.from('order_items')\r\n        .select(`\r\n          id, \r\n          quantity, \r\n          price, \r\n          order:orders!inner(id, status, created_at, buyer_id), \r\n          product:products!inner(name, farmer_id)\r\n        `)\r\n        .eq('product.farmer_id', user.id)\r\n        .order('created_at', { foreignTable: 'order', ascending: false })\r\n        .limit(5);\r\n\r\n      const orders: Order[] = (orderData || []).map((item: any) => {\r\n        const order = Array.isArray(item.order) ? item.order[0] : item.order;\r\n        const product = Array.isArray(item.product) ? item.product[0] : item.product;\r\n\r\n        return {\r\n          id: order?.id || item.id,\r\n          product: product?.name || 'Unknown Product',\r\n          buyer: 'Customer',\r\n          status: order?.status || 'pending',\r\n          amount: (item.quantity * (item.price || 0)).toFixed(2),\r\n          date: order?.created_at ? new Date(order.created_at).toLocaleDateString() : 'N/A',\r\n          quantity: item.quantity\r\n        };\r\n      });\r\n      setRecentOrders(orders);\r\n\r\n    } catch (e) {\r\n      console.error('[FarmerHome] Data load error:', e);\r\n    }\r\n  }, [user?.id]);\r\n\r\n  useEffect(() => {\r\n    initializeUser();\r\n  }, [initializeUser]);\r\n\r\n  useEffect(() => {\r\n    if (user?.id) {\r\n      loadFarmerData();\r\n    }\r\n  }, [user?.id, loadFarmerData]);\r\n\r\n  const onRefresh = useCallback(async () => {\r\n    setRefreshing(true);\r\n    await loadFarmerData();\r\n    setRefreshing(false);\r\n  }, [user]);\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      console.log(\"[FarmerHome] Logout clicked. Setting flag...\");\r\n      await AsyncStorage.setItem('logging_out', 'true');\r\n      (router as any).replace(\"/\");\r\n      await supabase.auth.signOut();\r\n      await AsyncStorage.removeItem('user_session');\r\n    } catch (error) {\r\n      (router as any).replace(\"/\");\r\n    }\r\n  };\r\n\r\n  if (loading) return <View className=\"flex-1 bg-white justify-center items-center\"><ActivityIndicator size=\"large\" color=\"#16a34a\" /></View>;\r\n\r\n  return (\r\n    <View className=\"flex-1 bg-[#f8fafc]\">\r\n      <StatusBar style=\"light\" />\r\n\r\n      {/* Simple Header */}\r\n      <View className=\"bg-green-600 pt-14 pb-6 px-6 shadow-md\">\r\n        <View className=\"flex-row justify-between items-center mb-4\">\r\n          <View>\r\n            <Text className=\"text-green-100 text-xs font-bold uppercase\">Farmer Portal</Text>\r\n            <Text className=\"text-2xl font-bold text-white\">\r\n              Hello, {user?.full_name?.split(' ')[0] || 'Farmer'}!\r\n            </Text>\r\n          </View>\r\n          <TouchableOpacity\r\n            onPress={handleLogout}\r\n            className=\"bg-green-700 p-2 rounded-lg\"\r\n          >\r\n            <Ionicons name=\"log-out-outline\" size={24} color=\"white\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <View className=\"bg-green-700/30 p-4 rounded-xl\">\r\n          <Text className=\"text-green-50 text-xs font-bold uppercase mb-1\">Total Revenue</Text>\r\n          <Text className=\"text-white text-3xl font-bold\">${farmerStats.totalRevenue.toLocaleString()}</Text>\r\n        </View>\r\n      </View>\r\n\r\n      <ScrollView\r\n        className=\"flex-1 -mt-8\"\r\n        contentContainerStyle={{ paddingHorizontal: 20, paddingBottom: 40 }}\r\n        showsVerticalScrollIndicator={false}\r\n        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor=\"#16a34a\" />}\r\n      >\r\n        {/* Secondary Stats Row */}\r\n        <View className=\"flex-row justify-between mt-6 mb-6\">\r\n          <View className=\"w-[48%] bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\r\n            <Text className=\"text-gray-400 text-xs font-bold uppercase mb-1\">Pending Orders</Text>\r\n            <Text className=\"text-xl font-bold text-gray-800\">{farmerStats.pendingOrders}</Text>\r\n          </View>\r\n          <View className=\"w-[48%] bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\r\n            <Text className=\"text-gray-400 text-xs font-bold uppercase mb-1\">Active Products</Text>\r\n            <Text className=\"text-xl font-bold text-gray-800\">{farmerStats.productsListed}</Text>\r\n          </View>\r\n        </View>\r\n\r\n        {/* Quick Actions */}\r\n        <Text className=\"text-lg font-bold text-gray-800 mb-4\">Quick Actions</Text>\r\n        <View className=\"bg-white p-4 rounded-xl shadow-sm border border-gray-100 mb-8 flex-row justify-between\">\r\n          <TouchableOpacity\r\n            onPress={() => router.push(\"/add-product\")}\r\n            className=\"items-center\"\r\n          >\r\n            <View className=\"bg-green-100 p-3 rounded-full mb-2\">\r\n              <Ionicons name=\"add\" size={24} color=\"#16a34a\" />\r\n            </View>\r\n            <Text className=\"text-xs font-bold text-gray-700\">Add Product</Text>\r\n          </TouchableOpacity>\r\n          <TouchableOpacity\r\n            onPress={() => router.push(\"/my-products\")}\r\n            className=\"items-center\"\r\n          >\r\n            <View className=\"bg-blue-100 p-3 rounded-full mb-2\">\r\n              <Ionicons name=\"list\" size={24} color=\"#2563eb\" />\r\n            </View>\r\n            <Text className=\"text-xs font-bold text-gray-700\">Inventory</Text>\r\n          </TouchableOpacity>\r\n          <TouchableOpacity\r\n            onPress={() => router.push(\"/supply-market\")}\r\n            className=\"items-center\"\r\n          >\r\n            <View className=\"bg-orange-100 p-3 rounded-full mb-2\">\r\n              <Ionicons name=\"basket\" size={24} color=\"#ea580c\" />\r\n            </View>\r\n            <Text className=\"text-xs font-bold text-gray-700\">Supplies</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {/* Recent Orders Section */}\r\n        <View className=\"flex-row justify-between items-center mb-4\">\r\n          <Text className=\"text-lg font-bold text-gray-800\">Recent Sales</Text>\r\n          <TouchableOpacity onPress={() => router.push(\"/(tabs)/orders\" as any)}>\r\n            <Text className=\"text-green-600 font-bold\">See all</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        {recentOrders.length === 0 ? (\r\n          <View className=\"bg-white p-8 rounded-xl border border-gray-200 items-center\">\r\n            <Text className=\"text-gray-400\">No orders yet.</Text>\r\n          </View>\r\n        ) : (\r\n          recentOrders.map(order => (\r\n            <View\r\n              key={order.id}\r\n              className=\"bg-white p-4 rounded-xl border border-gray-100 mb-3 flex-row items-center shadow-sm\"\r\n            >\r\n              <View className=\"flex-1\">\r\n                <Text className=\"font-bold text-gray-800\">{order.product}</Text>\r\n                <Text className=\"text-gray-500 text-xs\">{order.date}</Text>\r\n              </View>\r\n              <View className=\"items-end\">\r\n                <Text className=\"font-bold text-green-700\">${order.amount}</Text>\r\n                <Text className={`text-[10px] font-bold uppercase ${order.status === 'pending' ? 'text-yellow-600' : 'text-green-600'}`}>\r\n                  {order.status}\r\n                </Text>\r\n              </View>\r\n            </View>\r\n          ))\r\n        )}\r\n      </ScrollView>\r\n\r\n      {/* Floating Action Button */}\r\n      <TouchableOpacity\r\n        onPress={() => router.push(\"/add-product\")}\r\n        className=\"absolute bottom-6 right-6 bg-green-600 w-14 h-14 rounded-full items-center justify-center shadow-lg\"\r\n      >\r\n        <Ionicons name=\"add\" size={30} color=\"white\" />\r\n      </TouchableOpacity>\r\n    </View>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\agri\\components\\homes\\SupplierHome.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":51,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":51,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from '@/lib/supabaseClient';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { useRouter } from \"expo-router\";\r\nimport { StatusBar } from \"expo-status-bar\";\r\nimport { useCallback, useEffect, useState } from \"react\";\r\nimport {\r\n  RefreshControl,\r\n  ScrollView,\r\n  Text,\r\n  TouchableOpacity,\r\n  View,\r\n} from \"react-native\";\r\n\r\nexport default function SupplierHome() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState<any>(null);\r\n  const [stats, setStats] = useState({ totalSales: 0, activeSupplies: 0 });\r\n  const [supplies, setSupplies] = useState<any[]>([]);\r\n  const [refreshing, setRefreshing] = useState(false);\r\n\r\n  const loadData = useCallback(async () => {\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) { router.replace(\"/\"); return; }\r\n\r\n    const { data } = await supabase.from('profiles').select('*').eq('id', user.id).single();\r\n    setUser({ ...user, ...data });\r\n\r\n    const { data: suppliesData } = await supabase.from('supplies').select('*').eq('supplier_id', user.id);\r\n    setSupplies(suppliesData || []);\r\n    setStats(prev => ({ ...prev, activeSupplies: suppliesData?.length || 0 }));\r\n  }, [router]);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, [loadData]);\r\n\r\n  const onRefresh = async () => {\r\n    setRefreshing(true);\r\n    await loadData();\r\n    setRefreshing(false);\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      console.log(\"[SupplierHome] Logout clicked. Setting flag...\");\r\n      await AsyncStorage.setItem('logging_out', 'true');\r\n      (router as any).replace(\"/\");\r\n      await supabase.auth.signOut();\r\n      await AsyncStorage.removeItem('user_session');\r\n    } catch (error) {\r\n      (router as any).replace(\"/\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <View className=\"flex-1 bg-white\">\r\n      <StatusBar style=\"light\" />\r\n\r\n      {/* Header */}\r\n      <View className=\"bg-blue-600 pt-14 pb-8 px-6 shadow-md\">\r\n        <View className=\"flex-row justify-between items-center mb-6\">\r\n          <View>\r\n            <Text className=\"text-blue-100 text-xs font-bold uppercase\">Supplier Portal</Text>\r\n            <Text className=\"text-2xl font-bold text-white tracking-tight\">\r\n              {user?.full_name?.split(' ')[0] || 'Supplier'}!\r\n            </Text>\r\n          </View>\r\n          <TouchableOpacity\r\n            onPress={handleLogout}\r\n            className=\"bg-blue-700 p-2 rounded-lg\"\r\n          >\r\n            <Ionicons name=\"log-out-outline\" size={24} color=\"white\" />\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <View className=\"bg-blue-700/30 p-4 rounded-xl\">\r\n          <Text className=\"text-blue-50 text-xs font-bold uppercase mb-1\">Inventory Value</Text>\r\n          <Text className=\"text-white text-3xl font-bold\">$12,450</Text>\r\n        </View>\r\n      </View>\r\n\r\n      <ScrollView\r\n        className=\"flex-1 -mt-6\"\r\n        contentContainerStyle={{ paddingHorizontal: 24, paddingBottom: 100 }}\r\n        showsVerticalScrollIndicator={false}\r\n        refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} tintColor=\"#3b82f6\" />}\r\n      >\r\n        {/* Stats and Actions */}\r\n        <View className=\"flex-row justify-between mt-6 mb-8\">\r\n          <View className=\"w-[48%] bg-white p-4 rounded-xl shadow-sm border border-gray-100\">\r\n            <View className=\"flex-row justify-between items-center mb-2\">\r\n              <Text className=\"text-gray-400 text-xs font-bold uppercase\">Stock</Text>\r\n              <Ionicons name=\"cube\" size={16} color=\"#2563eb\" />\r\n            </View>\r\n            <Text className=\"text-2xl font-bold text-gray-800\">{stats.activeSupplies}</Text>\r\n          </View>\r\n          <TouchableOpacity\r\n            onPress={() => router.push(\"/add-supply\" as any)}\r\n            className=\"w-[48%] bg-blue-600 p-4 rounded-xl shadow-md items-center justify-center\"\r\n          >\r\n            <Text className=\"text-white font-bold\">Add Supply</Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n\r\n        <Text className=\"text-lg font-bold text-gray-800 mb-4\">My Supplies</Text>\r\n        {supplies.map((item) => (\r\n          <TouchableOpacity\r\n            key={item.id}\r\n            onPress={() => router.push({ pathname: \"/add-supply\", params: { id: item.id } })}\r\n            className=\"bg-white p-4 rounded-xl border border-gray-100 mb-3 flex-row justify-between items-center shadow-sm\"\r\n          >\r\n            <View className=\"flex-row items-center flex-1\">\r\n              <View className=\"bg-blue-50 w-10 h-10 rounded-lg items-center justify-center mr-4\">\r\n                <Text className=\"text-xl\">ðŸ“¦</Text>\r\n              </View>\r\n              <View className=\"flex-1\">\r\n                <Text className=\"font-bold text-gray-800\" numberOfLines={1}>{item.name}</Text>\r\n                <Text className=\"text-gray-500 text-xs\">${item.price} â€¢ Stock: {item.stock}</Text>\r\n              </View>\r\n            </View>\r\n            <Ionicons name=\"chevron-forward\" size={18} color=\"#9ca3af\" />\r\n          </TouchableOpacity>\r\n        ))}\r\n        {supplies.length === 0 && (\r\n          <View className=\"py-10 items-center bg-gray-50 rounded-[40px] border border-dashed border-gray-300\">\r\n            <Ionicons name=\"file-tray-outline\" size={40} color=\"#9ca3af\" />\r\n            <Text className=\"text-gray-400 mt-2 font-medium\">Clear of stock for now.</Text>\r\n          </View>\r\n        )}\r\n      </ScrollView>\r\n\r\n    </View>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_constraints.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_final.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_find_success.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_inspect.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_orders.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_orders_exhaustive.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_profile.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_profile_v2.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_schema.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_simple.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\debug_tables.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\expo-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\hooks\\useSupaAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\lib\\products.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\lib\\supabaseClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\metro.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\nativewind-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\test_status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"E:\\agri\\types\\database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
